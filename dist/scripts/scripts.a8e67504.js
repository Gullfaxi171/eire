"use strict";angular.module("workspaceApp",["ngCookies","ngResource","ngRoute","ngSanitize","ngTouch","ui.bootstrap"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).when("/timeline",{templateUrl:"views/timeline.html",controller:""}).otherwise({redirectTo:"/"})}]),angular.module("workspaceApp").controller("MainCtrl",["$scope",function(){}]),angular.module("workspaceApp").controller("PhotosphereModalCtrl",["$scope","spot",function(a,b){a.spot=b}]),angular.module("workspaceApp").controller("ModelModalCtrl",["$scope","spot","$sce",function(a,b,c){a.spot=b,a.model=c.trustAsHtml('<iframe width="640" height="480" src="'+a.spot.path+'" frameborder="0" allowfullscreen mozallowfullscreen="true" webkitallowfullscreen="true" onmousewheel=""></iframe>')}]),angular.module("workspaceApp").controller("GalleryModalCtrl",["$scope","spot",function(a,b){a.spot=b,a.interval=5e3;var c=b.pictures;a.slides=[],angular.forEach(c,function(b){a.slides.push({image:b.path,text:b.description})})}]),angular.module("workspaceApp").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("workspaceApp").factory("County",["$http",function(a){return{get:function(){return a.get("data/geo_data.json")}}}]),angular.module("workspaceApp").directive("raphael",["$compile","County","Photospheres","Models","Galleries","$q","$log","$modal",function(a,b,c,d,e,f,g,h){return{link:function(g,i){var j=new Raphael(i[0],710,910),k={},l=function(a){h.open({templateUrl:"photosphereModal.html",size:"lg",controller:"PhotosphereModalCtrl",resolve:{spot:function(){return a}}})},m=function(a){h.open({templateUrl:"modelModal.html",size:"lg",controller:"ModelModalCtrl",resolve:{spot:function(){return a}}})},n=function(a){h.open({templateUrl:"galleryModal.html",size:"lg",controller:"GalleryModalCtrl",resolve:{spot:function(){return a}}})},o=function(a,b,c){var d=c.type,e={fill:b,stroke:"red","stroke-width":1,"stroke-linejoin":"round",r:4,title:a.name},f={fill:b,stroke:"red","stroke-width":3,"stroke-linejoin":"round",r:10,title:a.name};0===d?k[a.id]=j.circle(a.coords.x,a.coords.y,4).attr(e).attr({href:""}).hover(function(){k[a.id].animate(f,100,"elastic")},function(){k[a.id].animate(e,300,"elastic")}).click(function(){l(a)}):1===d?k[a.id]=j.circle(a.coords.x,a.coords.y,4).attr(e).attr({href:""}).hover(function(){k[a.id].animate(f,100,"elastic")},function(){k[a.id].animate(e,300,"elastic")}).click(function(){m(a)}):2===d&&(k[a.id]=j.circle(a.coords.x,a.coords.y,4).attr(e).attr({href:""}).hover(function(){k[a.id].animate(f,100,"elastic")},function(){k[a.id].animate(e,300,"elastic")}).click(function(){n(a)}))};f.all([b.get(),c.get(),d.get(),e.get()]).then(function(a){var b=a[0].data.counties,c=a[1].data.photospheres,d=a[2].data.models,e=a[3].data.galleries;angular.forEach(b,function(a){k[a.name]=j.path(a.path).attr(a.attr).transform(a.transform).hover(function(){k[a.name].attr({fill:"#a8a239"})},function(){k[a.name].attr({fill:a.attr.fill})})}),angular.forEach(c,function(a){o(a,"#003bff",{type:0})}),angular.forEach(d,function(a){o(a,"#e84702",{type:1})}),angular.forEach(e,function(a){o(a,"#aad110",{type:2})})}),a(i.contents())(g)}}}]),angular.module("workspaceApp").service("Spots",function(){}),angular.module("workspaceApp").factory("Photospheres",["$http",function(a){return{get:function(){return a.get("data/photospheres.json")}}}]),angular.module("workspaceApp").directive("photosphere",["$log","$document","$window",function(){return{template:'<div id="sphere"></div>',restrict:"E",scope:{path:"@"},link:function(a,b,c){function d(){o.update(),requestAnimationFrame(d),k.render(i,j)}var e=b.find("div").attr("id","sphere"),f=640,g=480,h=-.5,i=new THREE.Scene,j=new THREE.PerspectiveCamera(75,f/g,1,1e3);j.position.x=.1;var k=Detector.webgl?new THREE.WebGLRenderer:new THREE.CanvasRenderer;k.setSize(f,g);var l=new THREE.SphereGeometry(100,50,50),m=new THREE.MeshBasicMaterial({map:THREE.ImageUtils.loadTexture(c.path)}),n=new THREE.Mesh(l,m);n.scale.x=-1,i.add(n);var o=new THREE.OrbitControls(j);o.noPan=!0,o.noZoom=!0,o.autoRotate=!0,o.autoRotateSpeed=h,e.html(k.domElement),d()}}}]);var Detector={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{var a=document.createElement("canvas");return!!window.WebGLRenderingContext&&(a.getContext("webgl")||a.getContext("experimental-webgl"))}catch(b){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var a=document.createElement("div");return a.id="webgl-error-message",a.style.fontFamily="monospace",a.style.fontSize="13px",a.style.fontWeight="normal",a.style.textAlign="center",a.style.background="#fff",a.style.color="#000",a.style.padding="1.5em",a.style.width="400px",a.style.margin="5em auto 0",this.webgl||(a.innerHTML=window.WebGLRenderingContext?['Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n"):['Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n")),a},addGetWebGLMessage:function(a){var b,c,d;a=a||{},b=void 0!==a.parent?a.parent:document.body,c=void 0!==a.id?a.id:"oldie",d=Detector.getWebGLErrorMessage(),d.id=c,b.appendChild(d)}};THREE.OrbitControls=function(a,b){function c(){return 2*Math.PI/60/60*p.autoRotateSpeed}function d(){return Math.pow(.95,p.zoomSpeed)}function e(){p.autoRotateSpeed=0}function f(a){clearTimeout(o),o=setTimeout(function(){p.autoRotateSpeed=-.5},a)}function g(a){if(e(),p.enabled!==!1){if(a.preventDefault(),0===a.button){if(p.noRotate===!0)return;G=F.ROTATE,r.set(a.clientX,a.clientY)}else if(1===a.button){if(p.noZoom===!0)return;G=F.DOLLY,x.set(a.clientX,a.clientY)}else if(2===a.button){if(p.noPan===!0)return;G=F.PAN,u.set(a.clientX,a.clientY)}p.domElement.addEventListener("mousemove",h,!1),p.domElement.addEventListener("mouseup",i,!1)}}function h(a){if(p.enabled!==!1){a.preventDefault();var b=p.domElement===document?p.domElement.body:p.domElement;if(G===F.ROTATE){if(p.noRotate===!0)return;s.set(a.clientX,a.clientY),t.subVectors(s,r),p.rotateLeft(2*Math.PI*t.x/b.clientWidth*p.rotateSpeed),p.rotateUp(2*Math.PI*t.y/b.clientHeight*p.rotateSpeed),r.copy(s)}else if(G===F.DOLLY){if(p.noZoom===!0)return;y.set(a.clientX,a.clientY),z.subVectors(y,x),z.y>0?p.dollyIn():p.dollyOut(),x.copy(y)}else if(G===F.PAN){if(p.noPan===!0)return;v.set(a.clientX,a.clientY),w.subVectors(v,u),p.pan(w),u.copy(v)}p.update()}}function i(){f(5500),p.enabled!==!1&&(p.domElement.removeEventListener("mousemove",h,!1),p.domElement.removeEventListener("mouseup",i,!1),G=F.NONE)}function j(a){if(p.enabled!==!1&&p.noZoom!==!0){var b=0;a.wheelDelta?b=a.wheelDelta:a.detail&&(b=-a.detail),b>0?p.dollyOut():p.dollyIn()}}function k(a){if(p.enabled!==!1&&p.noKeys!==!0&&p.noPan!==!0){var b=!1;switch(a.keyCode){case p.keys.UP:p.pan(new THREE.Vector2(0,p.keyPanSpeed)),b=!0;break;case p.keys.BOTTOM:p.pan(new THREE.Vector2(0,-p.keyPanSpeed)),b=!0;break;case p.keys.LEFT:p.pan(new THREE.Vector2(p.keyPanSpeed,0)),b=!0;break;case p.keys.RIGHT:p.pan(new THREE.Vector2(-p.keyPanSpeed,0)),b=!0}b&&p.update()}}function l(a){if(e(),p.enabled!==!1)switch(a.touches.length){case 1:if(p.noRotate===!0)return;G=F.TOUCH_ROTATE,r.set(a.touches[0].pageX,a.touches[0].pageY);break;case 2:if(p.noZoom===!0)return;G=F.TOUCH_DOLLY;var b=a.touches[0].pageX-a.touches[1].pageX,c=a.touches[0].pageY-a.touches[1].pageY,d=Math.sqrt(b*b+c*c);x.set(0,d);break;case 3:if(p.noPan===!0)return;G=F.TOUCH_PAN,u.set(a.touches[0].pageX,a.touches[0].pageY);break;default:G=F.NONE}}function m(a){if(p.enabled!==!1){a.preventDefault(),a.stopPropagation();var b=p.domElement===document?p.domElement.body:p.domElement;switch(a.touches.length){case 1:if(p.noRotate===!0)return;if(G!==F.TOUCH_ROTATE)return;s.set(a.touches[0].pageX,a.touches[0].pageY),t.subVectors(s,r),p.rotateLeft(2*Math.PI*t.x/b.clientWidth*p.rotateSpeed),p.rotateUp(2*Math.PI*t.y/b.clientHeight*p.rotateSpeed),r.copy(s);break;case 2:if(p.noZoom===!0)return;if(G!==F.TOUCH_DOLLY)return;var c=a.touches[0].pageX-a.touches[1].pageX,d=a.touches[0].pageY-a.touches[1].pageY,e=Math.sqrt(c*c+d*d);y.set(0,e),z.subVectors(y,x),z.y>0?p.dollyOut():p.dollyIn(),x.copy(y);break;case 3:if(p.noPan===!0)return;if(G!==F.TOUCH_PAN)return;v.set(a.touches[0].pageX,a.touches[0].pageY),w.subVectors(v,u),p.pan(w),u.copy(v);break;default:G=F.NONE}}}function n(){f(5500),p.enabled!==!1&&(G=F.NONE)}this.object=a,this.domElement=void 0!==b?b:document,this.enabled=!0,this.target=new THREE.Vector3,this.center=this.target,this.noZoom=!1,this.zoomSpeed=1,this.minDistance=0,this.maxDistance=1/0,this.noRotate=!1,this.rotateSpeed=1,this.noPan=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.noKeys=!1,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40};var o,p=this,q=1e-6,r=new THREE.Vector2,s=new THREE.Vector2,t=new THREE.Vector2,u=new THREE.Vector2,v=new THREE.Vector2,w=new THREE.Vector2,x=new THREE.Vector2,y=new THREE.Vector2,z=new THREE.Vector2,A=0,B=0,C=1,D=new THREE.Vector3,E=new THREE.Vector3,F={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_DOLLY:4,TOUCH_PAN:5},G=F.NONE,H={type:"change"};this.rotateLeft=function(a){void 0===a&&(a=c()),B+=a},this.rotateUp=function(a){void 0===a&&(a=c()),A+=a},this.panLeft=function(a){var b=new THREE.Vector3,c=this.object.matrix.elements;b.set(c[0],c[1],c[2]),b.multiplyScalar(-a),D.add(b)},this.panUp=function(a){var b=new THREE.Vector3,c=this.object.matrix.elements;b.set(c[4],c[5],c[6]),b.multiplyScalar(a),D.add(b)},this.pan=function(a){var b=p.domElement===document?p.domElement.body:p.domElement;if(void 0!==p.object.fov){var c=p.object.position,d=c.clone().sub(p.target),e=d.length();e*=Math.tan(p.object.fov/2*Math.PI/180),p.panLeft(2*a.x*e/b.clientHeight),p.panUp(2*a.y*e/b.clientHeight)}else void 0!==p.object.top?(p.panLeft(a.x*(p.object.right-p.object.left)/b.clientWidth),p.panUp(a.y*(p.object.top-p.object.bottom)/b.clientHeight)):console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled.")},this.dollyIn=function(a){void 0===a&&(a=d()),C/=a},this.dollyOut=function(a){void 0===a&&(a=d()),C*=a},this.update=function(){var a=this.object.position,b=a.clone().sub(this.target),d=Math.atan2(b.x,b.z),e=Math.atan2(Math.sqrt(b.x*b.x+b.z*b.z),b.y);this.autoRotate&&this.rotateLeft(c()),d+=B,e+=A,e=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,e)),e=Math.max(q,Math.min(Math.PI-q,e));var f=b.length()*C;f=Math.max(this.minDistance,Math.min(this.maxDistance,f)),this.target.add(D),b.x=f*Math.sin(e)*Math.sin(d),b.y=f*Math.cos(e),b.z=f*Math.sin(e)*Math.cos(d),a.copy(this.target).add(b),this.object.lookAt(this.target),B=0,A=0,C=1,D.set(0,0,0),E.distanceTo(this.object.position)>0&&(this.dispatchEvent(H),E.copy(this.object.position))},this.domElement.addEventListener("contextmenu",function(a){a.preventDefault()},!1),this.domElement.addEventListener("mousedown",g,!1),this.domElement.addEventListener("mousewheel",j,!1),this.domElement.addEventListener("DOMMouseScroll",j,!1),this.domElement.addEventListener("keydown",k,!1),this.domElement.addEventListener("touchstart",l,!1),this.domElement.addEventListener("touchend",n,!1),this.domElement.addEventListener("touchmove",m,!1)},THREE.OrbitControls.prototype=Object.create(THREE.EventDispatcher.prototype),angular.module("workspaceApp").factory("Models",["$http",function(a){return{get:function(){return a.get("data/3dmodels.json")}}}]),angular.module("workspaceApp").factory("Galleries",["$http",function(a){return{get:function(){return a.get("data/galleries.json")}}}]);